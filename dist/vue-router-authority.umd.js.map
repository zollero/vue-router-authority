{"version":3,"file":"vue-router-authority.umd.js","sources":["../src/index.js"],"sourcesContent":["\n\nexport default class VueRouterGuard {\n\n  constructor(options = {}) {\n    this.accessRoutes = options.accessRoutes || []\n    this.defaultRoute = options.defaultRoute || ''\n    // this.\n  }\n\n  RouterAuthority (to, from, next) {\n    let { pageOperations } = store.state.login\n\n    if (to.path === '/' || to.path === '/welcome') {\n      next()\n      return\n    }\n\n    if (pageOperations.length === 0) {\n      if (from.name !== null) {\n        next('/welcome')\n        return\n      } else {\n        // 刷新页面，这时还没获得权限内容，需要在这里手动调权限接口来获得\n        loginApi.getOperation().then(response => {\n          const { code, data } = response\n          if (code === '00000') {\n            pageOperations = data.pageOperations\n            toggleLoading()\n            routerHandler(to, from, next, pageOperations)\n          } else {\n            pageOperations = []\n            next()\n          }\n        })\n      }\n    } else {\n      routerHandler(to, from, next, pageOperations)\n    }\n  }\n}\n\nfunction routerHandler(to, from, next, pageOperations) {\n  let hasAccess = false\n  pageOperations.forEach(v => {\n    if (v === to.name) {\n      hasAccess = true\n    }\n  })\n\n  if (hasAccess) {\n    next()\n  } else {\n    Message.info({\n      message: '没有权限'\n    })\n    if (from.name) {\n      next(from.path)\n    } else {\n      next('/welcome')\n    }\n  }\n}\n"],"names":["VueRouterGuard","options","accessRoutes","defaultRoute","to","from","next","pageOperations","store","state","login","path","length","name","getOperation","then","code","response","data","routerHandler","hasAccess","forEach","v","info"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEqBA;4BAEO;QAAdC,OAAc,uEAAJ,EAAI;;;SACnBC,YAAL,GAAoBD,QAAQC,YAAR,IAAwB,EAA5C;SACKC,YAAL,GAAoBF,QAAQE,YAAR,IAAwB,EAA5C;;;;;;oCAIeC,IAAIC,MAAMC,MAAM;UACzBC,cADyB,GACNC,MAAMC,KAAN,CAAYC,KADN,CACzBH,cADyB;;;UAG3BH,GAAGO,IAAH,KAAY,GAAZ,IAAmBP,GAAGO,IAAH,KAAY,UAAnC,EAA+C;;;;;UAK3CJ,eAAeK,MAAf,KAA0B,CAA9B,EAAiC;YAC3BP,KAAKQ,IAAL,KAAc,IAAlB,EAAwB;eACjB,UAAL;;SADF,MAGO;;mBAEIC,YAAT,GAAwBC,IAAxB,CAA6B,oBAAY;gBAC/BC,IAD+B,GAChBC,QADgB,CAC/BD,IAD+B;gBACzBE,IADyB,GAChBD,QADgB,CACzBC,IADyB;;gBAEnCF,SAAS,OAAb,EAAsB;+BACHE,KAAKX,cAAtB;;4BAEcH,EAAd,EAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,cAA9B;aAHF,MAIO;+BACY,EAAjB;;;WAPJ;;OANJ,MAkBO;sBACSH,EAAd,EAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,cAA9B;;;;;;;AAKN,SAASY,aAAT,CAAuBf,EAAvB,EAA2BC,IAA3B,EAAiCC,IAAjC,EAAuCC,cAAvC,EAAuD;MACjDa,YAAY,KAAhB;iBACeC,OAAf,CAAuB,aAAK;QACtBC,MAAMlB,GAAGS,IAAb,EAAmB;kBACL,IAAZ;;GAFJ;;MAMIO,SAAJ,EAAe;;GAAf,MAEO;YACGG,IAAR,CAAa;eACF;KADX;QAGIlB,KAAKQ,IAAT,EAAe;WACRR,KAAKM,IAAV;KADF,MAEO;WACA,UAAL;;;;;;;;;;;"}